<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Number Match - Woodber Style</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            --panel: rgba(255, 255, 255, 0.08);
            --text: #ffffff;
            /* Couleurs des chiffres */
            --c1: #ff6b6b; --c2: #4ecdc4; --c3: #ffe66d; 
            --c4: #a29bfe; --c5: #fd79a8; --c6: #55efc4; 
            --c7: #fab1a0; --c8: #00cec9; --c9: #74b9ff;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-gradient);
            color: var(--text);
            overflow: hidden;
        }

        /* --- ACCUEIL --- */
        #home-screen {
            position: fixed; inset: 0; z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--bg-gradient);
            transition: transform 0.5s ease-in-out;
        }

        .menu-card {
            background: var(--panel); backdrop-filter: blur(20px);
            padding: 40px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.1);
            text-align: center; width: 80%; max-width: 350px;
        }

        .btn {
            width: 100%; padding: 15px; margin: 10px 0; border: none; border-radius: 15px;
            font-size: 1.1rem; font-weight: bold; color: white; cursor: pointer;
        }
        .btn-new { background: #6c5ce7; box-shadow: 0 4px 15px rgba(108, 92, 231, 0.4); }
        .btn-resume { background: #00b894; }

        /* --- JEU --- */
        #game-interface { display: flex; flex-direction: column; height: 100vh; }
        
        .header {
            padding: 20px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.2);
        }

        #grid-container { flex: 1; overflow-y: auto; padding: 20px 10px 150px; }
        
        #grid {
            display: grid; grid-template-columns: repeat(9, 1fr);
            gap: 8px; width: 100%; max-width: 450px; margin: 0 auto;
        }

        .cell {
            aspect-ratio: 1; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.4rem; font-weight: 900;
            background: rgba(255,255,255,0.05);
            transition: all 0.2s; position: relative;
        }

        /* Classes de couleurs par chiffre */
        .n1 { color: var(--c1); } .n2 { color: var(--c2); } .n3 { color: var(--c3); }
        .n4 { color: var(--c4); } .n5 { color: var(--c5); } .n6 { color: var(--c6); }
        .n7 { color: var(--c7); } .n8 { color: var(--c8); } .n9 { color: var(--c9); }

        .cell.selected {
            background: #fff; color: #000; transform: scale(1.1);
            box-shadow: 0 0 15px #fff; z-index: 10;
        }

        .cell.empty { opacity: 0; pointer-events: none; }

        .toolbar {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 10px; background: rgba(0,0,0,0.6);
            padding: 15px; border-radius: 25px; backdrop-filter: blur(10px);
        }

        .tool {
            background: #4834d4; border: none; color: white; padding: 10px 15px;
            border-radius: 12px; font-weight: bold; font-size: 0.8rem;
        }
    </style>
</head>
<body>

    <div id="home-screen">
        <div class="menu-card">
            <h1 style="margin-top:0">NUMBER<br><span style="color:#6c5ce7">MATCH</span></h1>
            <button id="resume-btn" class="btn btn-resume" style="display:none" onclick="start(true)">REPRENDRE</button>
            <button class="btn btn-new" onclick="start(false)">NOUVEAU JEU</button>
        </div>
    </div>

    <div id="game-interface">
        <div class="header">
            <div>Score: <span id="score" style="color:#ffe66d">0</span></div>
            <button onclick="location.reload()" style="background:none; border:none; color:white; opacity:0.6">Menu</button>
        </div>
        <div id="grid-container">
            <div id="grid"></div>
        </div>
        <div class="toolbar">
            <button class="tool" onclick="addRows()">âž• Lignes</button>
            <button class="tool" onclick="getHint()">ðŸ’¡ Aide</button>
            <button class="tool" onclick="bomb()" style="background:#eb4d4b">ðŸ’£ Bombe</button>
        </div>
    </div>

    <script>
        let state = { nums: [], score: 0, selected: null };

        function start(resume) {
            if (!resume) {
                state.nums = Array.from({length: 27}, () => Math.floor(Math.random()*9)+1);
                state.score = 0;
            } else {
                state = JSON.parse(localStorage.getItem('woodber_save'));
            }
            document.getElementById('home-screen').style.transform = 'translateY(-100%)';
            render();
        }

        function render() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            state.nums.forEach((n, i) => {
                const cell = document.createElement('div');
                cell.className = `cell ${n === null ? 'empty' : 'n'+n}`;
                if (i === state.selected) cell.classList.add('selected');
                cell.textContent = n || '';
                cell.onclick = () => handleTap(i);
                grid.appendChild(cell);
            });
            document.getElementById('score').innerText = state.score;
            localStorage.setItem('woodber_save', JSON.stringify(state));
        }

        function handleTap(i) {
            if (state.nums[i] === null) return;
            if (state.selected === null) {
                state.selected = i;
            } else if (state.selected === i) {
                state.selected = null;
            } else {
                if (checkMatch(state.selected, i)) {
                    state.nums[state.selected] = null;
                    state.nums[i] = null;
                    state.score += 10;
                    state.selected = null;
                } else {
                    state.selected = i;
                }
            }
            render();
        }

        function checkMatch(i1, i2) {
            const v1 = state.nums[i1];
            const v2 = state.nums[i2];
            if (v1 !== v2 && v1 + v2 !== 10) return false;

            let start = Math.min(i1, i2);
            let end = Math.max(i1, i2);

            // 1. VÃ©rification Horizontale / Lecture continue
            // On vÃ©rifie s'il n'y a que des null entre start et end dans le tableau linÃ©aire
            let blocked = false;
            for (let k = start + 1; k < end; k++) {
                if (state.nums[k] !== null) { blocked = true; break; }
            }
            if (!blocked) return true;

            // 2. VÃ©rification Verticale
            // Ils doivent Ãªtre sur la mÃªme colonne et n'avoir que des null entre eux verticalement
            if (i1 % 9 === i2 % 9) {
                let vBlocked = false;
                for (let k = start + 9; k < end; k += 9) {
                    if (state.nums[k] !== null) { vBlocked = true; break; }
                }
                if (!vBlocked) return true;
            }

            // 3. VÃ©rification Diagonale (Optionnel dans Woodber, mais ajoutÃ© pour le fun)
            if (Math.abs((i1 % 9) - (i2 % 9)) === Math.abs(Math.floor(i1 / 9) - Math.floor(i2 / 9))) {
                let diff = (i2 > i1) ? (i2 - i1) : (i1 - i2);
                let step = (i2 > i1) ? 0 : 0;
                // Calcul du pas diagonal (8 ou 10)
                let rowDiff = Math.floor(end/9) - Math.floor(start/9);
                let colDiff = (end % 9) - (start % 9);
                let diagStep = (colDiff > 0) ? 10 : 8; 
                
                let dBlocked = false;
                for (let k = start + diagStep; k < end; k += diagStep) {
                    if (state.nums[k] !== null) { dBlocked = true; break; }
                }
                if (!dBlocked && (start + (rowDiff * diagStep) === end)) return true;
            }

            return false;
        }

        function addRows() {
            const active = state.nums.filter(n => n !== null);
            state.nums = [...state.nums, ...active];
            render();
        }

        function bomb() {
            let count = 0;
            while(count < 5 && state.nums.some(n => n !== null)) {
                let r = Math.floor(Math.random() * state.nums.length);
                if (state.nums[r] !== null) { state.nums[r] = null; count++; }
            }
            render();
        }

        function getHint() {
            for (let i = 0; i < state.nums.length; i++) {
                if (state.nums[i] === null) continue;
                for (let j = i + 1; j < state.nums.length; j++) {
                    if (state.nums[j] !== null && checkMatch(i, j)) {
                        state.selected = i;
                        render();
                        return;
                    }
                }
            }
        }

        // Init
        if (localStorage.getItem('woodber_save')) {
            document.getElementById('resume-btn').style.display = 'block';
        }
    </script>
</body>
</html>