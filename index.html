<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Number Match Infinity - Pro</title>
    <style>
        :root {
            --bg: #0f172a;
            --grid-bg: #1e293b;
            --cell-empty: rgba(255, 255, 255, 0.03);
            --text: #f8fafc;
            --c1: #ff4d4d; --c2: #2ecc71; --c3: #f1c40f; 
            --c4: #9b59b6; --c5: #e67e22; --c6: #1abc9c; 
            --c7: #e84393; --c8: #3498db; --c9: #a29bfe;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg); color: var(--text);
            overflow: hidden; touch-action: manipulation;
        }

        /* --- UI ELEMENTS --- */
        .game-header {
            padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(15,23,42,0.95); border-bottom: 1px solid rgba(255,255,255,0.1);
            z-index: 100;
        }

        .stat { font-weight: 900; color: var(--c3); font-size: 1.2rem; }

        #grid-container {
            flex: 1; overflow-y: auto; padding: 20px 10px 180px;
            display: flex; flex-direction: column; align-items: center;
            height: calc(100vh - 70px);
        }

        #grid {
            display: grid; grid-template-columns: repeat(9, 1fr);
            gap: 6px; width: 100%; max-width: 450px;
            background: rgba(255,255,255,0.02); padding: 5px; border-radius: 10px;
        }

        .cell {
            aspect-ratio: 1; border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.3rem; font-weight: 900;
            background: var(--cell-empty);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(255,255,255,0.02);
        }

        /* Chiffres actifs */
        .cell.active { background: var(--grid-bg); box-shadow: 0 2px 4px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.05); }
        .cell.selected { background: #fff !important; color: #000 !important; transform: scale(1.1); box-shadow: 0 0 15px #fff; z-index: 5; }
        
        /* Obstacles */
        .cell.obstacle { background: #475569; color: #94a3b8; font-size: 1rem; opacity: 1; border: 2px solid #334155; }

        .v1 { color: var(--c1); } .v2 { color: var(--c2); } .v3 { color: var(--c3); }
        .v4 { color: var(--c4); } .v5 { color: var(--c5); } .v6 { color: var(--c6); }
        .v7 { color: var(--c7); } .v8 { color: var(--c8); } .v9 { color: var(--c9); }

        .toolbar {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 10px; background: rgba(15, 23, 42, 0.95);
            padding: 12px 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }

        .btn {
            background: #4f46e5; border: none; color: white; padding: 12px;
            border-radius: 12px; font-weight: bold; font-size: 0.8rem; min-width: 80px;
        }

        #lvl-alert {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: var(--c2); color: #000; padding: 20px 40px; border-radius: 20px;
            font-weight: 900; font-size: 1.5rem; display: none; z-index: 1000;
        }
    </style>
</head>
<body style="display: flex; flex-direction: column;">

    <div class="game-header">
        <div>NIVEAU <span id="lvl" class="stat">1</span></div>
        <div style="text-align: right;">SCORE <span id="scr" class="stat">0</span></div>
    </div>

    <div id="grid-container">
        <div id="grid"></div>
    </div>

    <div id="lvl-alert">NIVEAU RÃ‰USSI ! ðŸš€</div>

    <div class="toolbar">
        <button class="btn" onclick="addRows()">âž• LIGNES</button>
        <button class="btn" onclick="getHint()">ðŸ’¡ AIDE</button>
        <button class="btn" style="background:#ef4444" onclick="bomb()">ðŸ’£ BOMBE</button>
    </div>

    <script>
        let state = { nums: [], score: 0, level: 1, selected: null };

        function initLevel() {
            // GÃ©nÃ©ration de base : 27 chiffres
            state.nums = Array.from({length: 27}, () => Math.floor(Math.random()*9)+1);
            
            // Ajout d'obstacles tous les 10 niveaux (ex: Niv 10, 20, 30...)
            if (state.level >= 10 && state.level % 10 === 0) {
                const obstacleCount = Math.floor(state.level / 10) * 2;
                for(let i=0; i<obstacleCount; i++) {
                    let pos = Math.floor(Math.random() * state.nums.length);
                    state.nums[pos] = "ðŸ”’"; 
                }
            }
            render();
        }

        function render() {
            // 1. Suppression des lignes vides (toutes les 9 cases consÃ©cutives nulles)
            cleanEmptyLines();

            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            
            state.nums.forEach((n, i) => {
                const cell = document.createElement('div');
                const isNum = typeof n === 'number';
                const isObs = n === "ðŸ”’";
                
                cell.className = `cell ${isNum ? 'active v'+n : ''} ${isObs ? 'obstacle' : ''}`;
                if (i === state.selected) cell.classList.add('selected');
                
                cell.textContent = n || '';
                cell.onclick = () => handleTap(i);
                grid.appendChild(cell);
            });

            document.getElementById('scr').innerText = state.score;
            document.getElementById('lvl').innerText = state.level;
            
            // VÃ©rification victoire (si plus aucun nombre)
            if (state.nums.every(n => typeof n !== 'number')) {
                nextLevel();
            }
        }

        function cleanEmptyLines() {
            // On vÃ©rifie par blocs de 9
            for (let i = 0; i <= state.nums.length - 9; i += 9) {
                let chunk = state.nums.slice(i, i + 9);
                if (chunk.every(n => n === null)) {
                    state.nums.splice(i, 9);
                    i -= 9; // On recule pour vÃ©rifier la nouvelle ligne dÃ©calÃ©e
                }
            }
        }

        function handleTap(i) {
            const val = state.nums[i];
            if (typeof val !== 'number') return;

            if (state.selected === null) {
                state.selected = i;
            } else if (state.selected === i) {
                state.selected = null;
            } else {
                if (checkMatch(state.selected, i)) {
                    state.nums[state.selected] = null;
                    state.nums[i] = null;
                    state.score += 10;
                    state.selected = null;
                } else {
                    state.selected = i;
                }
            }
            render();
        }

        function checkMatch(i1, i2) {
            const v1 = state.nums[i1];
            const v2 = state.nums[i2];
            if (v1 !== v2 && v1 + v2 !== 10) return false;

            let start = Math.min(i1, i2);
            let end = Math.max(i1, i2);

            // CoordonnÃ©es pour calculs
            const x1 = i1 % 9, y1 = Math.floor(i1 / 9);
            const x2 = i2 % 9, y2 = Math.floor(i2 / 9);

            // 1. Horizontal (sur la mÃªme ligne ou lecture continue)
            let blockedLinear = false;
            for (let k = start + 1; k < end; k++) {
                if (state.nums[k] !== null) { blockedLinear = true; break; }
            }
            if (!blockedLinear) return true;

            // 2. Vertical
            if (x1 === x2) {
                let blockedV = false;
                for (let k = start + 9; k < end; k += 9) {
                    if (state.nums[k] !== null) { blockedV = true; break; }
                }
                if (!blockedV) return true;
            }

            // 3. Diagonale
            if (Math.abs(x1 - x2) === Math.abs(y1 - y2)) {
                const stepX = x2 > x1 ? 1 : -1;
                const stepY = y2 > y1 ? 1 : -1;
                let cx = x1 + stepX;
                let cy = y1 + stepY;
                let blockedD = false;
                while (cx !== x2) {
                    if (state.nums[cy * 9 + cx] !== null) { blockedD = true; break; }
                    cx += stepX; cy += stepY;
                }
                if (!blockedD) return true;
            }
            return false;
        }

        function addRows() {
            const active = state.nums.filter(n => typeof n === 'number');
            state.nums = [...state.nums, ...active];
            render();
        }

        function bomb() {
            let targets = state.nums.map((n, i) => typeof n === 'number' ? i : null).filter(n => n !== null);
            for(let i=0; i<Math.min(5, targets.length); i++) {
                let randIdx = Math.floor(Math.random() * targets.length);
                state.nums[targets[randIdx]] = null;
                targets.splice(randIdx, 1);
            }
            render();
        }

        function getHint() {
            for (let i = 0; i < state.nums.length; i++) {
                if (typeof state.nums[i] !== 'number') continue;
                for (let j = i + 1; j < state.nums.length; j++) {
                    if (typeof state.nums[j] === 'number' && checkMatch(i, j)) {
                        state.selected = i;
                        render(); return;
                    }
                }
            }
        }

        function nextLevel() {
            const alert = document.getElementById('lvl-alert');
            alert.style.display = 'block';
            setTimeout(() => {
                alert.style.display = 'none';
                state.level++;
                initLevel();
            }, 1500);
        }

        initLevel();
    </script>
</body>
</html>